// ========================================================================
// String.prototype Tests
// ========================================================================
/*globals module test ok isObj equals expects */


module("String object");

test("The String object should be prototyped with containsString", function() {
  var needle = 'Email Address', haystack = 'Email Address and Foo';

  equals(haystack.containsString(needle,true), true, haystack + ' should strictly contain ' + needle);

  equals(haystack.containsString(needle), true, haystack + ' should fuzzy contain ' + needle);

  needle = 'address email';
  equals(haystack.containsString(needle), true, haystack + ' should fuzzy contain ' + needle);

  equals(!haystack.containsString(needle, true), true, haystack + ' should not strictly contain ' + needle);
});

var rawString = String('<table width="602" border="0" cellspacing="0" cellpadding="1" bgcolor="#cdcccc">  <tr>    <td><table width="600" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">      <tr>        <td><img src="red_bar.png" width="600" height="28"></td>      </tr>      <tr>        <td><img src="http://qaimg.en25.com/EloquaImages/clients/OrionTest/{f575606d-d43d-44e3-a26f-ea767f8e4856}_http://qaimg.en25.com/EloquaImages/clients/OrionTest/{f575606d-d43d-44e3-a26f-ea767f8e4856}_K-12_red_bar.png" width="600" height="75"></td>      </tr>      <tr>        <td><table width="600" border="0" cellspacing="0" cellpadding="0">          <tr>            <td valign="top" width="445" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-top:15px; padding-left:20px; padding-right:20px; padding-bottom:20px;"><p style="font-family: Arial, Helvetica, sans-serif; font-size:22px; line-height:100%; letter-spacing:1px; color:#ac0040; font-weight:bold;">Reliable Wi-Fi to support 21st Century learning</p>              <p>Educators are finding that students learn best when they interact with digital curricula using smartphones, netbooks, laptops, and tablets. And with budgets tight, many schools are allowing students to bring their own devices (BYOD). Other schools provide laptops and tablets to all students—such as Faith Lutheran middle and high schools in Las Vegas and Essa Academy and Newent Community College in the UK.</p>Supporting the exploding number of laptops and tablets required for 1:1 learning is a difficult job, and the underlying wireless LAN isn&rsquo;t always up to the task of such heavy-duty usage. If your school is implementing 1:1 or BYOD, then you need to:<ul>                <li>Meet the growing need for wireless LAN capacity with <br>                  robust Wi-Fi </li>                <li>Consider management options and device requirements</li>            </ul>              <p>Find out how you can get a cost-effective, scalable, reliable Wi-Fi network that supports your 1:1 or BYOD initiatives.</p>              <table width="100%" border="0" cellspacing="0" cellpadding="0">                <tr>                  <td style="padding-top:15px; padding-bottom:15px;"><strong><a href="#">Download the Information Kit</a></strong></td>                </tr>              </table>              <p>Sincerely,</p>              <p>Lise Mills<br>                Education BU Manager, K12<br>                Meru Networks<br>                <a href="mailto:education@merunetworks.com">education@merunetworks.com</a></p></td>            <td valign="top" width="155" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-top:20px; padding-right:10px; padding-bottom:20px;"><table width="100%" border="0" cellspacing="0" cellpadding="0">              <tr>                <td style="padding-top:10px;"><center>                  <a href="#"><img src="btn_download.png" width="145" height="41" alt="download"></a>                </center></td>              </tr>              <tr>                <td style="padding-bottom:15px; padding-top:20px;"><center>                  <img src="kit.png" alt="" width="145" height="140">                </center></td>              </tr>                <td bgcolor="#dedddc"><table width="100%" border="0" cellspacing="0" cellpadding="1">                  <tr>                    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">                      <tr>                        <td style="font-family:Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#2a4383; padding-left:10px; padding-right:10px; padding-top:5px; padding-bottom:5px;"><p>The information kit includes:</p>                          <p>Faith Lutheran Middle School &amp; High School Case Study</p>                          <p>Meru Wireless LAN Connects 2,000 Apple Devices at Essa Academy Video Case Study</p>                          <p>One-to-One 2.0: Building on the BYOD Revolution E-Book</p>                          Newent College Community School Video Case Study</td>                      </tr>                    </table></td>                  </tr>                </table></td>              </table></td></tr>                      </table></td></tr>              </table></td></tr>            <tr>        <td><table width="600" border="0" cellspacing="0" cellpadding="0">      <tr>        <td width="41%" align="left" valign="middle"><p span="" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-left:20px;"><a href="http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~">www.merunetworks.com</a>              </p></td>        <td><table width="349" border="0" cellspacing="0" cellpadding="0">          <tr>            <td width="150" align="right" valign="middle"><p style="font-size: 10px; font-family: Arial, Helvetica, sans-serif; font-weight: bold; color: #666; line-height: 12pt;">Stay Connected&nbsp;&nbsp;</p></td>            <td width="40"><a href="http://blog.merunetworks.com/blog/feed/?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~" target="_new"><img src="stay-connected_RSS.gif" alt="RSS" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://www.facebook.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~" target="_new"><img src="stay-connected_Facebook.gif" alt="FaceBook" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://www.linkedin.com/companies/meru-networks?trk=co_search_results&goback=.cps_1249851842049_1&elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~" target="_new"><img src="stay-connected_LinkedIn.gif" alt="LinkedIn" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://twitter.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~" target="_new"><img src="stay-connected_Twitter.gif" alt="Twitter" width="40" height="36" border="0"></a></td>            <td width="39"><a href="http://www.youtube.com/merunetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~" target="_new"><img src="stay-connected_YouTube.gif" alt="YouTube" width="40" height="36" border="0"></a></td>          </tr>        </table></td>      </tr>    </table></td>      </tr>      <tr>        <td style="padding-top:10px;"><img src="red_bar.png" width="600" height="28"></td>      </tr>      <table width="602" border="0" cellspacing="0" cellpadding="10">  <tr>    <td align="center"><p style="font-size: 10px; font-family: Arial, Helvetica, sans-serif;font-weight: bold; color: #999; line-height: 11pt;">              &nbsp;&nbsp;<a href="http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"><font color="#ac0040">www.merunetworks.com</font></a> | 1.877.952.6725 |&nbsp;&copy; Meru Networks. All Rights Reserved.</p></td>  </tr></table></table>');
var correctedString = String('<table width="602" border="0" cellspacing="0" cellpadding="1" bgcolor="#cdcccc">  <tr>    <td><table width="600" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">      <tr>        <td><img src="red_bar.png" width="600" height="28"></td>      </tr>      <tr>        <td><img src="http://qaimg.en25.com/EloquaImages/clients/OrionTest/{f575606d-d43d-44e3-a26f-ea767f8e4856}_http://qaimg.en25.com/EloquaImages/clients/OrionTest/{f575606d-d43d-44e3-a26f-ea767f8e4856}_K-12_red_bar.png" width="600" height="75"></td>      </tr>      <tr>        <td><table width="600" border="0" cellspacing="0" cellpadding="0">          <tr>            <td valign="top" width="445" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-top:15px; padding-left:20px; padding-right:20px; padding-bottom:20px;"><p style="font-family: Arial, Helvetica, sans-serif; font-size:22px; line-height:100%; letter-spacing:1px; color:#ac0040; font-weight:bold;">Reliable Wi-Fi to support 21st Century learning</p>              <p>Educators are finding that students learn best when they interact with digital curricula using smartphones, netbooks, laptops, and tablets. And with budgets tight, many schools are allowing students to bring their own devices (BYOD). Other schools provide laptops and tablets to all students—such as Faith Lutheran middle and high schools in Las Vegas and Essa Academy and Newent Community College in the UK.</p>Supporting the exploding number of laptops and tablets required for 1:1 learning is a difficult job, and the underlying wireless LAN isn&rsquo;t always up to the task of such heavy-duty usage. If your school is implementing 1:1 or BYOD, then you need to:<ul>                <li>Meet the growing need for wireless LAN capacity with <br>                  robust Wi-Fi </li>                <li>Consider management options and device requirements</li>            </ul>              <p>Find out how you can get a cost-effective, scalable, reliable Wi-Fi network that supports your 1:1 or BYOD initiatives.</p>              <table width="100%" border="0" cellspacing="0" cellpadding="0">                <tr>                  <td style="padding-top:15px; padding-bottom:15px;"><strong><a href="#?elqTrack=true">Download the Information Kit</a></strong></td>                </tr>              </table>              <p>Sincerely,</p>              <p>Lise Mills<br>                Education BU Manager, K12<br>                Meru Networks<br>                <a href="mailto:education@merunetworks.com">education@merunetworks.com</a></p></td>            <td valign="top" width="155" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-top:20px; padding-right:10px; padding-bottom:20px;"><table width="100%" border="0" cellspacing="0" cellpadding="0">              <tr>                <td style="padding-top:10px;"><center>                  <a href="#?elqTrack=true"><img src="btn_download.png" width="145" height="41" alt="download"></a>                </center></td>              </tr>              <tr>                <td style="padding-bottom:15px; padding-top:20px;"><center>                  <img src="kit.png" alt="" width="145" height="140">                </center></td>              </tr>                <td bgcolor="#dedddc"><table width="100%" border="0" cellspacing="0" cellpadding="1">                  <tr>                    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">                      <tr>                        <td style="font-family:Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#2a4383; padding-left:10px; padding-right:10px; padding-top:5px; padding-bottom:5px;"><p>The information kit includes:</p>                          <p>Faith Lutheran Middle School &amp; High School Case Study</p>                          <p>Meru Wireless LAN Connects 2,000 Apple Devices at Essa Academy Video Case Study</p>                          <p>One-to-One 2.0: Building on the BYOD Revolution E-Book</p>                          Newent College Community School Video Case Study</td>                      </tr>                    </table></td>                  </tr>                </table></td>              </table></td></tr>                      </table></td></tr>              </table></td></tr>            <tr>        <td><table width="600" border="0" cellspacing="0" cellpadding="0">      <tr>        <td width="41%" align="left" valign="middle"><p span="" style="font-family: Arial, Helvetica, sans-serif; font-size:12px; line-height:120%; color:#000000; padding-left:20px;"><a href="http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true">www.merunetworks.com</a>              </p></td>        <td><table width="349" border="0" cellspacing="0" cellpadding="0">          <tr>            <td width="150" align="right" valign="middle"><p style="font-size: 10px; font-family: Arial, Helvetica, sans-serif; font-weight: bold; color: #666; line-height: 12pt;">Stay Connected&nbsp;&nbsp;</p></td>            <td width="40"><a href="http://blog.merunetworks.com/blog/feed/?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true" target="_new"><img src="stay-connected_RSS.gif" alt="RSS" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://www.facebook.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true" target="_new"><img src="stay-connected_Facebook.gif" alt="FaceBook" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://www.linkedin.com/companies/meru-networks?trk=co_search_results&goback=.cps_1249851842049_1&elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true" target="_new"><img src="stay-connected_LinkedIn.gif" alt="LinkedIn" width="40" height="36" border="0"></a></td>            <td width="40"><a href="http://twitter.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true" target="_new"><img src="stay-connected_Twitter.gif" alt="Twitter" width="40" height="36" border="0"></a></td>            <td width="39"><a href="http://www.youtube.com/merunetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true" target="_new"><img src="stay-connected_YouTube.gif" alt="YouTube" width="40" height="36" border="0"></a></td>          </tr>        </table></td>      </tr>    </table></td>      </tr>      <tr>        <td style="padding-top:10px;"><img src="red_bar.png" width="600" height="28"></td>      </tr>      <table width="602" border="0" cellspacing="0" cellpadding="10">  <tr>    <td align="center"><p style="font-size: 10px; font-family: Arial, Helvetica, sans-serif;font-weight: bold; color: #999; line-height: 11pt;">              &nbsp;&nbsp;<a href="http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"><font color="#ac0040">www.merunetworks.com</font></a> | 1.877.952.6725 |&nbsp;&copy; Meru Networks. All Rights Reserved.</p></td>  </tr></table></table>');
var matchReplacePats = [
  ['"#"','"#?elqTrack=true"'],
  ['"http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://www.merunetworks.com?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"'],
  ['"http://blog.merunetworks.com/blog/feed/?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://blog.merunetworks.com/blog/feed/?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"'],
  ['"http://www.facebook.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://www.facebook.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"'],
  ['"http://www.linkedin.com/companies/meru-networks?trk=co_search_results&goback=.cps_1249851842049_1&elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://www.linkedin.com/companies/meru-networks?trk=co_search_results&goback=.cps_1249851842049_1&elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"'],
  ['"http://twitter.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://twitter.com/MeruNetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"'],
  ['"http://www.youtube.com/merunetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~"','"http://www.youtube.com/merunetworks?elq=~~eloqua..type--emailfield..syntax--recipientid~~&elqCampaignId=~~eloqua..type--campaign..campaignid--0..fieldname--id~~?elqTrack=true"']
];

test("The string object should be prototyped with replaceAll", function () {
  ok(String.prototype.hasOwnProperty('replaceAll'), 'String has replaceAll method');

  var ret = rawString;
  matchReplacePats.forEach(function (p) {
    ret = ret.replaceAll(p[0],p[1]);
  });

  ok((ret===correctedString),'Replaced all complex strings correctly');
});

